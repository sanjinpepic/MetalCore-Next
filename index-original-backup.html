<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetalCore - Premium Metallurgy</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        obsidian: '#0a0a0b',
                        glass: 'rgba(255, 255, 255, 0.05)',
                        'glass-hover': 'rgba(255, 255, 255, 0.1)',
                        accent: '#f59e0b',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;700&family=Outfit:wght@700;900&display=swap"
        rel="stylesheet">

    <style>
        body {
            background-color: #050505;
            color: #e2e8f0;
        }

        .glass-panel {
            background: rgba(20, 20, 25, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 20px;
        }

        /* Mobile Menu Styles */
        @media (max-width: 768px) {
            .mobile-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }

            .mobile-sidebar.open {
                transform: translateX(0);
            }
        }

        #error-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0b;
            color: #ef4444;
            z-index: 9999;
            padding: 40px;
            font-family: monospace;
            overflow: auto;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
            color: #94a3b8;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: #f59e0b;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div id="error-overlay"></div>
    <div id="loading">
        <div class="spinner"></div>
        <h2 class="text-xl font-bold text-white mb-2">Initialize MetalCore</h2>
        <p class="text-xs text-slate-500 font-mono">Loading local resources...</p>
    </div>
    <div id="root"></div>

    <!-- LOCAL LIBRARIES -->
    <script src="libs/react.js"></script>
    <script src="libs/react-dom.js"></script>
    <script src="libs/recharts.js"></script>
    <script src="data/steels.js"></script>
    <script src="data/knives.js"></script>
    <script src="libs/prop-types.js"></script>
    <script src="libs/classnames.js"></script>
    <script src="libs/babel.js"></script>
    <script src="libs/lucide.js"></script>
    <script src="libs/xlsx.js"></script>
    <script src="libs/recharts.js"></script>

    <!-- PROJECT DATA -->
    <script src="data/steels.js"></script>

    <script type="module">
        import { GoogleGenerativeAI } from 'https://esm.run/@google/generative-ai';
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>

    <script>
        // Global Error Handler
        window.onerror = function (msg, url, line, col, error) {
            const el = document.getElementById('error-overlay');
            el.style.display = 'block';
            el.innerHTML += `<div style="margin-bottom:20px; border-left: 2px solid #ef4444; padding-left: 10px;">
                <h3 style="font-weight:bold; margin-bottom:5px;">System Error</h3>
                <p style="margin-bottom:5px;">${msg}</p>
                <small style="opacity:0.6;">${url}:${line}</small>
            </div>`;
            return false;
        };

        // Pre-check libs
        window.addEventListener('load', () => {
            const missing = [];
            if (!window.React) missing.push('React');
            if (!window.ReactDOM) missing.push('ReactDOM');
            if (!window.Babel) missing.push('Babel');

            const hasRecharts = window.Recharts || (window.Recharts && window.Recharts.default) || window._Recharts;
            if (!hasRecharts) missing.push('Recharts');

            if (missing.length > 0) {
                const el = document.getElementById('error-overlay');
                el.style.display = 'block';
                el.innerHTML += `<div style="padding: 20px; border: 1px solid #333; border-radius: 8px;">
                    <h1 style="font-size: 24px; color: white; margin-bottom: 10px;">Setup Incomplete</h1>
                    <p>Some local library files are missing or empty:</p>
                    <ul style="list-style: disc; margin-left: 20px; margin-top: 10px; color: #94a3b8;">
                        ${missing.map(m => `<li>${m}</li>`).join('')}
                    </ul>
                    <p style="margin-top: 20px; font-size: 12px; color: #64748b;">Debug info: Check console for detailed object dump.</p>
                 </div>`;
            }
        });
    </script>

    <script type="text/babel">
        // --- BOOTSTRAPPER ---
        const { useState, useMemo, useEffect, useRef } = React;

        // Shim Globals
        const LucideIcons = window.lucide || {};
        const RechartsLib = window.Recharts || window.Recharts?.default || window._Recharts;

        const {
            Radar, RadarChart, PolarGrid, PolarAngleAxis, ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, BarChart, Bar, ScatterChart, Scatter, ZAxis
        } = RechartsLib;

        // Custom Lucide Wrapper for React (since we use the core lib)
        const LucideIcon = ({ name, size = 18, className = "" }) => {
            const iconData = window.lucide ? window.lucide[name] : null;
            if (!iconData) return <span className="w-2 h-2 bg-slate-500 rounded-full inline-block"></span>;
            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                >
                    {iconData.map(([tag, attrs], i) => React.createElement(tag, { key: i, ...attrs }))}
                </svg>
            );
        };

        const Database = (p) => <LucideIcon name="Database" {...p} />;
        const FileSpreadsheet = (p) => <LucideIcon name="FileSpreadsheet" {...p} />;
        const Plus = (p) => <LucideIcon name="Plus" {...p} />;
        const Filter = (p) => <LucideIcon name="Filter" {...p} />;
        const SlidersHorizontal = (p) => <LucideIcon name="SlidersHorizontal" {...p} />;
        const Search = (p) => <LucideIcon name="Search" {...p} />;
        const Scale = (p) => <LucideIcon name="Scale" {...p} />;
        const X = (p) => <LucideIcon name="X" {...p} />;
        const ArrowRight = (p) => <LucideIcon name="ArrowRight" {...p} />;
        const ChevronLeft = (p) => <LucideIcon name="ChevronLeft" {...p} />;
        const Zap = (p) => <LucideIcon name="Zap" {...p} />;
        const Thermometer = (p) => <LucideIcon name="Thermometer" {...p} />;
        const Sparkles = (p) => <LucideIcon name="Sparkles" {...p} />;
        const Settings = (p) => <LucideIcon name="Settings" {...p} />;
        const Bot = (p) => <LucideIcon name="Bot" {...p} />;
        const MessageSquare = (p) => <LucideIcon name="MessageSquare" {...p} />;
        const Send = (p) => <LucideIcon name="Send" {...p} />;
        const Brain = (p) => <LucideIcon name="Brain" {...p} />;
        const Sword = (p) => <LucideIcon name="Sword" {...p} />;
        const History = (p) => <LucideIcon name="History" {...p} />;

        // --- PREMIUM DATASET LOADED FROM EXTERNAL FILE (data/steels.js) ---

        function SteelLedger() {
            const [steels, setSteels] = useState(PREMIUM_STEELS);
            const [view, setView] = useState('SEARCH');
            const [search, setSearch] = useState("");
            const [compareList, setCompareList] = useState([]);
            const [filters, setFilters] = useState({ minC: 0, minCr: 0, minV: 0 });
            const [activeProducer, setActiveProducer] = useState("ALL");
            const [detailSteel, setDetailSteel] = useState(null);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            // AI State
            const [apiKey, setApiKey] = useState(localStorage.getItem('metalcore_gemini_key') || "");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [aiOpen, setAiOpen] = useState(false);
            const [aiQuery, setAiQuery] = useState("");
            const [aiChat, setAiChat] = useState([]);
            const [aiModel, setAiModel] = useState(localStorage.getItem('metalcore_gemini_model') || "gemini-1.5-flash");
            const [showSettings, setShowSettings] = useState(false);

            const fileInputRef = useRef(null);

            const producers = ["ALL", ...new Set(steels.map(s => s.producer))];

            useEffect(() => {
                const loader = document.getElementById('loading');
                if (loader) loader.style.display = 'none';
            }, []);

            const handleImportClick = () => fileInputRef.current.click();

            const askAi = async (query = aiQuery) => {
                if (!apiKey) {
                    setShowSettings(true);
                    return;
                }
                if (!query.trim()) return;

                setIsAiLoading(true);
                const userMsg = { role: 'user', content: query };
                setAiChat(prev => [...prev, userMsg]);
                setAiQuery("");

                try {
                    const genAI = new window.GoogleGenerativeAI(apiKey);
                    const model = genAI.getGenerativeModel({ model: aiModel });

                    const systemPrompt = `You are the MetalCore AI Analyst. Expert in metallurgy and iconic knives.
Database: ${steels.map(s => `${s.name} (${s.producer}): C:${s.C}, Cr:${s.Cr}, V:${s.V}, Edge:${s.edge}, Toughness:${s.toughness}`).join(' | ')}
Knives: ${POPULAR_KNIVES.map(k => `${k.name} by ${k.maker}: Steels: ${k.steels.join(', ')}`).join(' | ')}
If recommending steels, trigger comparison with this exact JSON on a new line:
COMMAND: {"action": "compare", "steels": ["ExactName1", "ExactName2"]}
Be concise and premium.`;

                    const result = await model.generateContent([systemPrompt, ...aiChat.map(m => m.content), query]);
                    const responseText = result.response.text();

                    // Parse commands
                    const commandMatch = responseText.match(/COMMAND: ({.*})/);
                    if (commandMatch) {
                        try {
                            const cmd = JSON.parse(commandMatch[1]);
                            if (cmd.action === 'compare' && cmd.steels) {
                                const toCompare = steels.filter(s => cmd.steels.includes(s.name));
                                if (toCompare.length > 0) {
                                    setCompareList(toCompare);
                                    setView('COMPARE');
                                }
                            }
                        } catch (e) { console.error("AI Command Parse Error", e); }
                    }

                    setAiChat(prev => [...prev, { role: 'assistant', content: responseText.replace(/COMMAND: {.*}/, "") }]);
                } catch (err) {
                    setAiChat(prev => [...prev, { role: 'assistant', content: "Error: " + err.message }]);
                } finally {
                    setIsAiLoading(false);
                }
            };

            const generateReport = async () => {
                if (!apiKey) { setShowSettings(true); return; }
                if (compareList.length === 0) return;

                setIsAiLoading(true);
                try {
                    const genAI = new window.GoogleGenerativeAI(apiKey);
                    const model = genAI.getGenerativeModel({ model: aiModel });

                    const list = compareList.map(s => JSON.stringify(s)).join('\n');
                    const prompt = `Act as a senior metallurgist. Generate a professional "Comparative Performance Report" for these steels:\n${list}\nDetailed trade-offs, carbide structure analysis (based on alloy), and recommended deployment. Use clean Markdown.`;

                    const result = await model.generateContent(prompt);
                    setAiChat(prev => [...prev, { role: 'assistant', content: result.response.text(), isReport: true }]);
                    setAiOpen(true);
                } catch (err) {
                    alert("Report Error: " + err.message);
                } finally {
                    setIsAiLoading(false);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const bstr = evt.target.result;
                        const wb = XLSX.read(bstr, { type: 'binary' });
                        const ws = wb.Sheets[wb.SheetNames[0]];
                        const data = XLSX.utils.sheet_to_json(ws);
                        const formatted = data.map((row, idx) => {
                            const getVal = (key) => {
                                const k = Object.keys(row).find(k => k.toLowerCase() === key.toLowerCase());
                                return k ? row[k] : undefined;
                            };
                            return {
                                id: 'imported-' + Date.now() + idx,
                                name: getVal('Grade') || getVal('Name') || `Unknown ${idx + 1}`,
                                producer: getVal('Producer') || "Unknown",
                                C: parseFloat(getVal('C') || 0),
                                Cr: parseFloat(getVal('Cr') || 0),
                                V: parseFloat(getVal('V') || 0),
                                Mo: parseFloat(getVal('Mo') || 0),
                                W: parseFloat(getVal('W') || 0),
                                Co: parseFloat(getVal('Co') || 0),
                                edge: parseFloat(getVal('Edge') || 5),
                                toughness: parseFloat(getVal('Toughness') || 5),
                                corrosion: parseFloat(getVal('Corrosion') || 5),
                                sharpen: parseFloat(getVal('Sharpen') || 5),
                                ht_curve: getVal('ht_curve') || "",
                                desc: "Custom imported grade.",
                                knives: []
                            };
                        });
                        setSteels(prev => [...prev, ...formatted]);
                    } catch (err) { console.error(err); }
                };
                reader.readAsBinaryString(file);
            };

            const filteredSteels = useMemo(() => {
                return steels.filter(s =>
                    s.name.toLowerCase().includes(search.toLowerCase()) &&
                    s.C >= filters.minC && s.Cr >= filters.minCr && s.V >= filters.minV &&
                    (activeProducer === "ALL" || s.producer === activeProducer)
                );
            }, [steels, search, filters, activeProducer]);

            const toggleCompare = (steel, e) => {
                if (e) e.stopPropagation();
                if (compareList.find(i => i.id === steel.id)) {
                    setCompareList(compareList.filter(i => i.id !== steel.id));
                } else if (compareList.length < 4) {
                    setCompareList([...compareList, steel]);
                }
            };

            const getRadarData = () => {
                const metrics = ['edge', 'toughness', 'corrosion', 'sharpen'];
                return metrics.map(m => {
                    const entry = { subject: m.toUpperCase() };
                    compareList.forEach(s => { entry[s.name] = s[m]; });
                    return entry;
                });
            };

            const getCompositionData = () => {
                const elements = ['C', 'Cr', 'V', 'Mo', 'W', 'Co'];
                return elements.map(el => {
                    const entry = { element: el };
                    compareList.forEach(s => { entry[s.name] = s[el]; });
                    return entry;
                });
            };

            const getLineData = () => {
                const allTemps = new Set();
                compareList.forEach(s => {
                    if (s.ht_curve) s.ht_curve.split(',').forEach(p => allTemps.add(parseFloat(p.split(':')[0])));
                });
                return Array.from(allTemps).sort((a, b) => a - b).map(t => {
                    const entry = { temp: t };
                    compareList.forEach(s => {
                        if (s.ht_curve) {
                            const point = s.ht_curve.split(',').find(p => parseFloat(p.split(':')[0]) === t);
                            if (point) entry[s.name] = parseFloat(point.split(':')[1]);
                        }
                    });
                    return entry;
                });
            };

            const normalize = (val) => {
                if (!val) return "";
                return val.toLowerCase()
                    .replace(/cpm[- ]?/, "")
                    .replace(/böhler |bohler /, "")
                    .replace(/sandvik |alleima |alleima-/, "")
                    .replace(/[ \-]/g, "")
                    .trim();
            };

            const radarColors = ['#f59e0b', '#3b82f6', '#10b981', '#ec4899'];

            if (view === 'SEARCH' || view === 'LARRIN_PLOT' || view === 'KNIFE_LIBRARY') {
                return (
                    <div className="flex h-screen overflow-hidden font-sans bg-black relative">
                        {/* Mobile Menu Overlay */}
                        {mobileMenuOpen && (
                            <div
                                className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden"
                                onClick={() => setMobileMenuOpen(false)}
                            />
                        )}
                        {/* Detail Modal */}
                        {detailSteel && (
                            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6 bg-black/60 backdrop-blur-md" onClick={() => setDetailSteel(null)}>
                                <div className="glass-panel w-full max-w-2xl p-6 md:p-10 rounded-[1.5rem] md:rounded-[2.5rem] border border-white/10 shadow-2xl relative overflow-y-auto max-h-[90vh]" onClick={e => e.stopPropagation()}>
                                    <div className="sticky top-0 right-0 flex justify-end mb-2">
                                        <button onClick={() => setDetailSteel(null)} className="p-3 md:p-2 bg-white/5 hover:bg-white/10 rounded-full text-slate-400 transition-all"><X size={20} /></button>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                                        <div>
                                            <div className="text-xs font-black text-accent uppercase tracking-[0.2em] mb-3">{detailSteel.producer}</div>
                                            <h2 className="text-4xl font-display font-black text-white mb-4 leading-tight">{detailSteel.name}</h2>
                                            <div className="h-1 w-12 bg-accent rounded-full mb-6"></div>
                                            <p className="text-slate-400 text-lg leading-relaxed mb-8">{detailSteel.desc}</p>

                                            <div className="space-y-6">
                                                <div>
                                                    <div className="text-[10px] font-bold text-accent uppercase tracking-widest mb-3">Optimal Deployment</div>
                                                    <div className="px-5 py-3 bg-accent/10 border border-accent/20 rounded-2xl text-sm text-slate-200 flex items-center gap-3">
                                                        <Zap size={14} className="text-accent" /> {detailSteel.use_case}
                                                    </div>
                                                </div>

                                                {detailSteel.knives && detailSteel.knives.length > 0 && (
                                                    <div>
                                                        <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3">Popular Examples</div>
                                                        <div className="grid grid-cols-1 gap-2">
                                                            {detailSteel.knives.map((k, i) => (
                                                                <div key={i} className="px-5 py-3 bg-white/5 border border-white/5 rounded-2xl text-sm text-slate-200">
                                                                    • {k}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        <div className="space-y-8">
                                            <div className="glass-panel p-6 rounded-3xl border-white/5">
                                                <h4 className="text-xs font-bold text-white uppercase tracking-widest mb-6 flex items-center gap-2"><ArrowRight size={14} className="text-accent" /> The Edge Case</h4>
                                                <div className="space-y-6">
                                                    <div>
                                                        <div className="text-[10px] font-bold text-emerald-500 uppercase tracking-widest mb-2">Pros</div>
                                                        <div className="space-y-2">
                                                            {detailSteel.pros?.map((p, i) => (
                                                                <div key={i} className="text-sm text-slate-400 flex items-start gap-2">
                                                                    <div className="mt-1.5 w-1 h-1 rounded-full bg-emerald-500 shrink-0"></div>
                                                                    {p}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="text-[10px] font-bold text-rose-500 uppercase tracking-widest mb-2">Cons</div>
                                                        <div className="space-y-2">
                                                            {detailSteel.cons?.map((p, i) => (
                                                                <div key={i} className="text-sm text-slate-400 flex items-start gap-2">
                                                                    <div className="mt-1.5 w-1 h-1 rounded-full bg-rose-500 shrink-0"></div>
                                                                    {p}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="grid grid-cols-3 gap-3">
                                                {['C', 'Cr', 'V', 'Mo', 'W', 'Co'].map(el => (
                                                    <div key={el} className="bg-black/40 rounded-2xl p-4 text-center border border-white/5">
                                                        <div className="text-[8px] text-slate-500 uppercase font-black mb-1">{el}</div>
                                                        <div className="text-lg font-display font-black text-white">{detailSteel[el] || 0}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-12 pt-6 border-t border-white/5 flex justify-between items-center text-[10px] font-mono text-slate-600 uppercase tracking-widest">
                                        <span>Metallurgy Core</span>
                                        <span>EST. 2026</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Mobile Menu Button */}
                        <button
                            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                            className="fixed top-4 left-4 z-50 md:hidden p-3 bg-accent rounded-xl shadow-lg shadow-accent/20 text-black"
                        >
                            {mobileMenuOpen ? <X size={24} /> : (
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                    <line x1="3" y1="12" x2="21" y2="12" />
                                    <line x1="3" y1="6" x2="21" y2="6" />
                                    <line x1="3" y1="18" x2="21" y2="18" />
                                </svg>
                            )}
                        </button>

                        {/* Sidebar */}
                        <aside className={`fixed md:relative w-80 glass-panel border-r border-white/5 flex flex-col z-50 md:z-10 h-full transition-transform duration-300 ${mobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
                            <div className="p-6 md:p-8 pb-4 flex items-center justify-between">
                                <div className="flex items-center gap-3 text-accent font-display font-black text-xl md:text-2xl tracking-tighter">
                                    <Database size={24} /> METALCORE
                                </div>
                                <button onClick={() => setShowSettings(true)} className="p-2 rounded-xl bg-white/5 hover:bg-white/10 text-slate-500 hover:text-accent transition-all">
                                    <Settings size={18} />
                                </button>
                            </div>
                            <div className="flex-1 overflow-y-auto px-6 md:px-8 py-4 space-y-8 md:space-y-10 custom-scrollbar">
                                <div className="flex flex-col gap-2 mt-6 md:mt-10">
                                    <button onClick={() => { setView('SEARCH'); setMobileMenuOpen(false); }} className={`w-full py-4 px-6 rounded-2xl flex items-center gap-3 text-xs font-bold transition-all ${view === 'SEARCH' ? 'bg-accent text-black shadow-lg shadow-accent/20' : 'text-slate-500 hover:bg-white/5'}`}>
                                        <Database size={16} /> Grade Library
                                    </button>
                                    <button onClick={() => { setView('LARRIN_PLOT'); setMobileMenuOpen(false); }} className={`w-full py-4 px-6 rounded-2xl flex items-center gap-3 text-xs font-bold transition-all ${view === 'LARRIN_PLOT' ? 'bg-accent text-black shadow-lg shadow-accent/20' : 'text-slate-500 hover:bg-white/5'}`}>
                                        <SlidersHorizontal size={16} /> Performance Matrix
                                    </button>
                                    <button onClick={() => { setView('KNIFE_LIBRARY'); setMobileMenuOpen(false); }} className={`w-full py-4 px-6 rounded-2xl flex items-center gap-3 text-xs font-bold transition-all ${view === 'KNIFE_LIBRARY' ? 'bg-accent text-black shadow-lg shadow-accent/20' : 'text-slate-500 hover:bg-white/5'}`}>
                                        <Sword size={16} /> Knife Library
                                    </button>
                                    <button onClick={() => { setAiOpen(!aiOpen); setMobileMenuOpen(false); }} className={`w-full py-4 px-6 rounded-2xl flex items-center gap-3 text-xs font-bold transition-all ${aiOpen ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20' : 'text-slate-500 hover:bg-white/5 hover:text-indigo-400'}`}>
                                        <Sparkles size={16} /> AI Analyst
                                    </button>
                                </div>

                                <section className="pt-6">
                                    <button onClick={handleImportClick} className="w-full py-3 border border-dashed border-white/20 rounded-xl flex items-center justify-center gap-2 text-xs font-bold hover:bg-white/5 transition-all group">
                                        <FileSpreadsheet size={14} className="group-hover:text-accent transition-colors" /> Import Data
                                    </button>
                                    <input type="file" ref={fileInputRef} className="hidden" accept=".xlsx,.csv" onChange={handleFileUpload} />
                                </section>

                                <section className="space-y-4">
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2"><Filter size={12} /> Producer</div>
                                    <div className="flex flex-wrap gap-2">
                                        {producers.map(p => (
                                            <button key={p} onClick={() => setActiveProducer(p)} className={`text-[10px] uppercase font-bold px-3 py-1.5 rounded-full border transition-all ${activeProducer === p ? 'bg-accent text-black border-accent shadow-lg shadow-accent/20' : 'text-slate-500 border-slate-800 hover:border-slate-600'}`}>{p}</button>
                                        ))}
                                    </div>
                                </section>

                                <section className="space-y-8">
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2"><SlidersHorizontal size={12} /> Key Alloys</div>
                                    {['minC', 'minCr', 'minV'].map(f => (
                                        <div key={f} className="space-y-2">
                                            <div className="flex justify-between text-[11px] font-mono text-slate-400">
                                                <span>{f === 'minC' ? 'Carbon' : f === 'minCr' ? 'Chromium' : 'Vanadium'}</span>
                                                <span className="text-accent">{filters[f]}%</span>
                                            </div>
                                            <input type="range" min="0" max="5" step="0.1" value={filters[f]} onChange={e => setFilters({ ...filters, [f]: parseFloat(e.target.value) })} className="w-full accent-accent h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer" />
                                        </div>
                                    ))}
                                </section>
                            </div>
                        </aside>

                        {/* view === SEARCH view logic remains same, just need to handle the view conditional correctly */}
                        {view === 'SEARCH' && (
                            <div className="flex flex-col flex-1 min-w-0">
                                <header className="p-4 md:p-8 pb-4 pt-16 md:pt-8">
                                    <div className="relative bg-white/5 border border-white/10 rounded-2xl flex items-center px-4 py-2 group focus-within:border-accent/50 transition-all">
                                        <Search size={18} className="text-slate-500 mr-3 group-focus-within:text-accent transition-colors" />
                                        <input type="text" placeholder="Search grades..." className="w-full bg-transparent border-none text-white outline-none h-10" value={search} onChange={e => setSearch(e.target.value)} />
                                    </div>
                                </header>

                                <div className="flex-1 overflow-y-auto p-4 md:p-8 pt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 pb-32 custom-scrollbar">
                                    {filteredSteels.map(s => {
                                        const isSelected = compareList.find(i => i.id === s.id);
                                        return (
                                            <div key={s.id} onClick={() => setDetailSteel(s)} className={`glass-panel rounded-2xl md:rounded-3xl p-5 md:p-6 cursor-pointer border transition-all hover:-translate-y-1 hover:border-white/20 active:scale-[0.98] relative group ${isSelected ? 'border-accent bg-accent/5' : 'border-white/5'}`}>
                                                <div className="flex justify-between items-start mb-4">
                                                    <div>
                                                        <div className="text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1">{s.producer}</div>
                                                        <h3 className="text-lg font-bold text-white group-hover:text-accent transition-colors">{s.name}</h3>
                                                        <p className="text-[10px] text-slate-400 line-clamp-1 mt-1 font-medium opacity-80 group-hover:opacity-100 transition-opacity italic">{s.desc}</p>
                                                    </div>
                                                    <div className={`p-2 rounded-full transition-all ${isSelected ? 'bg-accent text-black scale-110 shadow-lg shadow-accent/40' : 'bg-white/5 text-slate-500 hover:text-white hover:bg-white/10'}`}
                                                        onClick={(e) => { e.stopPropagation(); toggleCompare(s); }}>
                                                        <Scale size={16} />
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-3 gap-2">
                                                    {['C', 'Cr', 'V', 'Mo', 'W', 'Co'].map(el => (
                                                        <div key={el} className="bg-black/40 rounded-lg p-2 text-center border border-white/5 group-hover:border-accent/10 transition-colors">
                                                            <div className="text-[8px] text-slate-500 uppercase font-black">{el}</div>
                                                            <div className="text-xs font-mono font-bold text-slate-300">{s[el] || 0}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="mt-4 pt-4 border-t border-white/5 flex items-center justify-between">
                                                    <span className="text-[10px] text-slate-600 font-bold uppercase">View Details</span>
                                                    <ArrowRight size={12} className="text-slate-700 group-hover:text-accent group-hover:translate-x-1 transition-all" />
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Comparison Tray (Bottom Overlay) */}
                                {compareList.length > 0 && (
                                    <div className="fixed bottom-4 md:bottom-8 left-1/2 -translate-x-1/2 glass-panel border border-accent/30 p-2 pr-2 pl-4 md:pl-6 rounded-full flex items-center gap-3 md:gap-6 backdrop-blur-3xl z-50 animate-float shadow-2xl max-w-[90vw]">
                                        <div className="text-xs font-black text-white tracking-widest">{compareList.length} SELECTED</div>
                                        <div className="h-6 w-px bg-white/10"></div>
                                        <button onClick={() => setView('COMPARE')} className="bg-accent text-black px-4 md:px-8 py-2.5 rounded-full font-bold text-xs md:text-sm flex items-center gap-2 hover:bg-white transition-all shadow-xl shadow-accent/20">
                                            <span className="hidden sm:inline">Compare Analysis</span>
                                            <span className="sm:hidden">Compare</span>
                                            <ArrowRight size={16} />
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'LARRIN_PLOT' && (
                            <div className="flex flex-col flex-1 min-w-0 p-4 md:p-8 pt-16 md:pt-8">
                                <div className="mb-8">
                                    <h2 className="text-2xl font-black font-display tracking-tight text-white mb-2 uppercase italic">Performance Matrix</h2>
                                    <p className="text-slate-500 text-sm">Visualizing the Toughness vs. Edge Retention trade-off (Larrin Plot).</p>
                                </div>
                                <div className="flex-1 glass-panel rounded-[2.5rem] p-10 relative overflow-hidden">
                                    {/* Quadrant Labels */}
                                    <div className="absolute top-10 right-10 text-[10px] font-black text-accent/40 uppercase tracking-[0.2em]">GOD TIER (High Both)</div>
                                    <div className="absolute bottom-10 left-10 text-[10px] font-black text-slate-700 uppercase tracking-[0.2em]">BUDGET (Balanced Low)</div>

                                    <ResponsiveContainer width="100%" height="100%">
                                        <ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 20 }}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" />
                                            <XAxis type="number" dataKey="edge" name="Edge Retention" stroke="#475569" unit="" domain={[0, 10]} label={{ value: 'Edge Retention', position: 'bottom', fill: '#64748b', fontSize: 10, dy: 10 }} />
                                            <YAxis type="number" dataKey="toughness" name="Toughness" stroke="#475569" unit="" domain={[0, 10]} label={{ value: 'Toughness', angle: -90, position: 'left', fill: '#64748b', fontSize: 10, dx: -10 }} />
                                            <Tooltip
                                                cursor={{ strokeDasharray: '3 3' }}
                                                content={({ active, payload }) => {
                                                    if (active && payload && payload.length) {
                                                        const data = payload[0].payload;
                                                        return (
                                                            <div className="glass-panel p-4 rounded-xl border border-white/10 shadow-2xl">
                                                                <div className="text-[10px] font-bold text-accent uppercase mb-1">{data.producer}</div>
                                                                <div className="text-sm font-bold text-white mb-2">{data.name}</div>
                                                                <div className="grid grid-cols-2 gap-4 border-t border-white/5 pt-2">
                                                                    <div>
                                                                        <div className="text-[8px] text-slate-500 uppercase">Edge</div>
                                                                        <div className="text-xs font-mono text-white">{data.edge}</div>
                                                                    </div>
                                                                    <div>
                                                                        <div className="text-[8px] text-slate-500 uppercase">Toughness</div>
                                                                        <div className="text-xs font-mono text-white">{data.toughness}</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    }
                                                    return null;
                                                }}
                                            />
                                            <Scatter name="Steels" data={steels} fill="#f59e0b" onClick={(data) => setDetailSteel(data)} shape={(props) => {
                                                const { cx, cy, fill } = props;
                                                return (
                                                    <g>
                                                        <circle cx={cx} cy={cy} r={6} fill={fill} className="cursor-pointer hover:r-8 transition-all hover:stroke-white hover:stroke-2" />
                                                        <circle cx={cx} cy={cy} r={10} fill={fill} fillOpacity={0.1} className="animate-pulse" />
                                                    </g>
                                                );
                                            }} />
                                        </ScatterChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        )}

                        {/* Knife Library View */}
                        {view === 'KNIFE_LIBRARY' && (
                            <div className="flex flex-col flex-1 min-w-0 h-screen overflow-y-auto custom-scrollbar pb-32">
                                <header className="p-4 md:p-12 pb-6 pt-16 md:pt-12">
                                    <h1 className="text-3xl md:text-5xl font-display font-black text-white tracking-tighter mb-4 italic">KNIFE LIBRARY</h1>
                                    <p className="text-slate-500 max-w-xl text-sm md:text-base">Iconic models that defined the industry. Click a steel variant to view its metallurgical breakdown.</p>
                                </header>
                                <div className="p-4 md:p-12 pt-4 grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                                    {POPULAR_KNIVES.map(knife => (
                                        <div key={knife.id} className="glass-panel rounded-[2.5rem] overflow-hidden flex flex-col md:flex-row group border-white/5 hover:border-white/10 transition-all">
                                            <div className="md:w-1/3 h-64 md:h-auto bg-white/5 relative overflow-hidden">
                                                {knife.image ? (
                                                    <img src={knife.image.replace('file:///', '')} alt={knife.name} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" />
                                                ) : (
                                                    <div className="w-full h-full flex items-center justify-center text-white/10"><Sword size={64} /></div>
                                                )}
                                                <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                                                <div className="absolute bottom-6 left-6">
                                                    <div className="text-[10px] font-bold text-accent uppercase tracking-widest mb-1">{knife.maker}</div>
                                                    <h3 className="text-2xl font-display font-black text-white">{knife.name}</h3>
                                                </div>
                                            </div>
                                            <div className="md:w-2/3 p-8 flex flex-col justify-between">
                                                <div className="space-y-4">
                                                    <div className="flex gap-2 items-start">
                                                        <MessageSquare size={16} className="text-accent mt-1 shrink-0" />
                                                        <p className="text-sm text-slate-400 italic leading-relaxed">{knife.description}</p>
                                                    </div>
                                                    <div className="flex gap-2 items-start">
                                                        <History size={16} className="text-slate-500 mt-1 shrink-0" />
                                                        <p className="text-sm text-slate-300 font-medium leading-relaxed">{knife.whySpecial}</p>
                                                    </div>
                                                </div>
                                                <div className="mt-8 pt-6 border-t border-white/5">
                                                    <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">{knife.category}</div>
                                                    <a href={knife.link} className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">Product Page</a>
                                                    <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">Steel Availability</div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {knife.steels.map(sName => {
                                                            const steel = steels.find(s => normalize(s.name) === normalize(sName));
                                                            return (
                                                                <button
                                                                    key={sName}
                                                                    onClick={() => steel ? setDetailSteel(steel) : alert(`Data for ${sName} (${normalize(sName)}) not found in database.`)}
                                                                    className="px-4 py-2 bg-white/5 border border-white/5 rounded-xl text-xs font-bold text-slate-300 hover:bg-accent hover:text-black hover:border-accent transition-all active:scale-95"
                                                                >
                                                                    {sName}
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* AI Analyst Panel */}
                        <div className={`fixed top-0 right-0 h-full w-full md:w-[400px] glass-panel border-l border-white/10 z-[60] transition-transform duration-500 ${aiOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                            <div className="flex flex-col h-full">
                                <header className="p-6 border-b border-white/5 flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-indigo-500/10 rounded-xl"><Bot size={20} className="text-indigo-400" /></div>
                                        <h3 className="font-display font-black text-white uppercase tracking-tighter italic">AI Analyst</h3>
                                    </div>
                                    <button onClick={() => setAiOpen(false)} className="p-2 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-all"><X size={20} /></button>
                                </header>

                                <div className="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">
                                    {aiChat.length === 0 && (
                                        <div className="text-center py-20 space-y-4">
                                            <Sparkles size={40} className="text-indigo-500/20 mx-auto" />
                                            <p className="text-slate-500 text-sm px-10">Ask me anything about blade steels, use cases, or chemistry. I can also trigger comparisons automatically.</p>
                                        </div>
                                    )}
                                    {aiChat.map((msg, i) => (
                                        <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`max-w-[85%] p-4 rounded-2xl text-sm leading-relaxed ${msg.role === 'user' ? 'bg-accent text-black font-medium rounded-tr-none' : 'bg-white/5 border border-white/10 text-slate-200 rounded-tl-none'}`}>
                                                {msg.isReport && <div className="text-[10px] font-black text-indigo-400 mb-2 uppercase tracking-widest flex items-center gap-2"><Brain size={12} /> Analytical Report</div>}
                                                <div className="prose prose-invert prose-sm max-w-none">
                                                    {msg.content.split('\n').map((line, j) => <p key={j} className="mb-2 last:mb-0">{line}</p>)}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {isAiLoading && (
                                        <div className="flex justify-start">
                                            <div className="bg-white/5 border border-white/10 p-4 rounded-2xl rounded-tl-none flex items-center gap-3">
                                                <div className="flex gap-1">
                                                    <div className="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce"></div>
                                                    <div className="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce [animation-delay:0.2s]"></div>
                                                    <div className="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce [animation-delay:0.4s]"></div>
                                                </div>
                                                <span className="text-xs text-slate-500 font-mono italic">Thinking...</span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="p-6 border-t border-white/5 bg-black/40">
                                    <div className="relative">
                                        <textarea
                                            placeholder="Ask about a steel..."
                                            className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 pr-12 text-sm text-white outline-none focus:border-indigo-500/50 transition-all resize-none h-24"
                                            value={aiQuery}
                                            onChange={e => setAiQuery(e.target.value)}
                                            onKeyDown={e => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), askAi())}
                                        />
                                        <button
                                            onClick={() => askAi()}
                                            disabled={isAiLoading || !aiQuery.trim()}
                                            className="absolute bottom-4 right-4 p-2 bg-indigo-500 text-white rounded-xl hover:bg-indigo-400 disabled:opacity-50 disabled:grayscale transition-all shadow-lg shadow-indigo-500/20"
                                        >
                                            <Send size={18} />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Settings Modal */}
                        {showSettings && (
                            <div className="fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/80 backdrop-blur-xl transition-all" onClick={() => setShowSettings(false)}>
                                <div className="glass-panel w-full max-w-md p-8 rounded-[2rem] border border-white/10 shadow-2xl relative" onClick={e => e.stopPropagation()}>
                                    <div className="flex justify-between items-center mb-8">
                                        <div className="flex items-center gap-3">
                                            <div className="p-2 bg-white/5 rounded-xl"><Settings size={20} className="text-slate-400" /></div>
                                            <h3 className="font-display font-black text-white uppercase tracking-tighter italic">Settings</h3>
                                        </div>
                                        <button onClick={() => setShowSettings(false)} className="p-2 hover:bg-white/5 rounded-full text-slate-500 transition-all"><X size={20} /></button>
                                    </div>

                                    <div className="space-y-6">
                                        <div className="space-y-3">
                                            <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest block">Gemini API Key</label>
                                            <input
                                                type="password"
                                                placeholder="Paste your API key here..."
                                                className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-sm text-white outline-none focus:border-accent/50 transition-all font-mono"
                                                value={apiKey}
                                                onChange={e => {
                                                    setApiKey(e.target.value);
                                                    localStorage.setItem('metalcore_gemini_key', e.target.value);
                                                }}
                                            />
                                            <p className="text-[10px] text-slate-500 leading-relaxed italic">Get a free API key from the <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-accent underline hover:text-white">Google AI Studio</a>. Keys are stored locally in your browser.</p>
                                        </div>

                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center">
                                                <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest block">Model Version</label>
                                                <div className="flex gap-2">
                                                    {["gemini-1.5-flash", "gemini-2.0-flash-exp", "gemini-1.5-pro"].map(m => (
                                                        <button
                                                            key={m}
                                                            onClick={() => {
                                                                setAiModel(m);
                                                                localStorage.setItem('metalcore_gemini_model', m);
                                                            }}
                                                            className={`text-[9px] px-2 py-1 rounded-md border transition-all ${aiModel === m ? 'bg-accent/20 border-accent/40 text-accent' : 'bg-white/5 border-white/10 text-slate-500 hover:border-white/20'}`}
                                                        >
                                                            {m.replace('gemini-', '')}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="e.g. gemini-1.5-flash"
                                                className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-sm text-white outline-none focus:border-accent/50 transition-all font-mono"
                                                value={aiModel}
                                                onChange={e => {
                                                    setAiModel(e.target.value);
                                                    localStorage.setItem('metalcore_gemini_model', e.target.value);
                                                }}
                                            />
                                            <p className="text-[10px] text-slate-500 leading-relaxed italic">Specify the model ID. Click a suggestion above or type a custom one.</p>
                                        </div>

                                        <button onClick={() => setShowSettings(false)} className="w-full py-4 bg-white text-black font-black uppercase tracking-widest rounded-2xl text-xs hover:bg-accent transition-all">Save & Close</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // --- VIEW RENDER: COMPARISON ---
            return (
                <div className="min-h-screen bg-black text-slate-200 p-4 md:p-8 overflow-y-auto custom-scrollbar">
                    <div className="max-w-[1400px] mx-auto">
                        <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8 md:mb-12">
                            <h1 className="text-xl md:text-2xl font-black font-display tracking-tighter">COMPARATIVE ANALYSIS</h1>
                            <div className="flex flex-col sm:flex-row gap-3 md:gap-4 w-full md:w-auto">
                                <button
                                    onClick={generateReport}
                                    disabled={isAiLoading || compareList.length === 0}
                                    className="flex items-center justify-center gap-2 bg-indigo-600 text-white px-6 py-2.5 rounded-full font-bold text-sm hover:bg-indigo-500 transition-all shadow-xl shadow-indigo-600/20 disabled:opacity-50"
                                >
                                    <Sparkles size={16} /> <span className="whitespace-nowrap">Generate AI Report</span>
                                </button>
                                <button onClick={() => setView('SEARCH')} className="flex items-center justify-center gap-2 text-slate-400 hover:text-white bg-white/5 px-4 py-2 rounded-full border border-white/5 hover:border-white/10 transition-all"><ChevronLeft size={18} /> Back to Library</button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8">
                            <div className="lg:col-span-4 space-y-3 md:space-y-4">
                                {compareList.map((s, i) => (
                                    <div key={s.id} className="glass-panel p-6 rounded-3xl border-l-4" style={{ borderLeftColor: radarColors[i] }}>
                                        <h3 className="font-bold text-white mb-2 text-xl">{s.name}</h3>
                                        <div className="grid grid-cols-6 gap-2 text-[8px] font-mono mt-4">
                                            {['C', 'Cr', 'V', 'Mo', 'W', 'Co'].map(el => (
                                                <div key={el} className="text-center p-1 bg-white/5 rounded border border-white/5">
                                                    <div className="text-slate-500 mb-1">{el}</div>
                                                    <div className="text-slate-200 font-bold">{s[el] || 0}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="lg:col-span-8 space-y-6 md:space-y-8">
                                <div className="glass-panel p-4 md:p-8 rounded-2xl md:rounded-[2rem]">
                                    <h3 className="font-bold text-white mb-6 flex items-center gap-2"><Database size={18} /> Chemistry Comparison</h3>
                                    <div className="h-[300px]">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={getCompositionData()}>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" vertical={false} />
                                                <XAxis dataKey="element" stroke="#475569" />
                                                <YAxis stroke="#475569" />
                                                <Tooltip contentStyle={{ backgroundColor: '#0a0a0b', border: '1px solid #333', borderRadius: '12px' }} />
                                                <Legend />
                                                {compareList.map((s, i) => <Bar key={s.id} dataKey={s.name} fill={radarColors[i]} radius={[4, 4, 0, 0]} />)}
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                    <div className="glass-panel p-4 md:p-8 rounded-2xl md:rounded-[2rem]">
                                        <h3 className="font-bold text-white mb-6 flex items-center gap-2"><Zap size={18} /> Performance Profile</h3>
                                        <div className="h-[250px]">
                                            <ResponsiveContainer>
                                                <RadarChart data={getRadarData()}>
                                                    <PolarGrid stroke="#334155" />
                                                    <PolarAngleAxis dataKey="subject" tick={{ fill: '#64748b', fontSize: 10 }} />
                                                    {compareList.map((s, i) => <Radar key={s.id} name={s.name} dataKey={s.name} stroke={radarColors[i]} fill={radarColors[i]} fillOpacity={0.2} />)}
                                                </RadarChart>
                                            </ResponsiveContainer>
                                        </div>
                                    </div>

                                    <div className="glass-panel p-4 md:p-8 rounded-2xl md:rounded-[2rem]">
                                        <h3 className="font-bold text-white mb-6 flex items-center gap-2"><Thermometer size={18} /> Tempering Curve</h3>
                                        <div className="h-[250px]">
                                            <ResponsiveContainer>
                                                <LineChart data={getLineData()}>
                                                    <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" />
                                                    <XAxis dataKey="temp" stroke="#475569" />
                                                    <YAxis stroke="#475569" />
                                                    <Tooltip contentStyle={{ backgroundColor: '#0a0a0b', border: '1px solid #333', borderRadius: '12px' }} />
                                                    {compareList.map((s, i) => <Line key={s.id} type="monotone" dataKey={s.name} stroke={radarColors[i]} strokeWidth={2} dot={{ r: 4, fill: radarColors[i] }} />)}
                                                </LineChart>
                                            </ResponsiveContainer>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SteelLedger />);
    </script>
</body>

</html>